#!/bin/bash
set -e

if [ "$ELASTICSEARCH_LOGIN" ] && [ "$ELASTICSEARCH_PASSWORD" ]
then
    ELASTICSEARCH_BASICAUTH=true
else
    ELASTICSEARCH_BASICAUTH=false
    ELASTICSEARCH_LOGIN=""
    ELASTICSEARCH_PASSWORD=""
fi

export ES_HEAP_SIZE=${ELASTICSEARCH_HEAPSIZE:-256m}

cat >$HOME/elasticsearch/config/elasticsearch.yml <<EOF
# Configuration generated by dotCloud script "$0"
http.port: $PORT_WWW-$PORT_WWW
path.plugins: $HOME/elasticsearch/plugins
path.data: $HOME/data
path.logs: /var/log/supervisor
http.basic.enabled: $ELASTICSEARCH_BASICAUTH
http.basic.user: $ELASTICSEARCH_LOGIN
http.basic.password: $ELASTICSEARCH_PASSWORD
#transport.tcp.port: $PORT_TRANSPORT-$PORT_TRANSPORT
#discovery.zen.ping.unicast.hosts: $ELASTICSEARCH_GOSSIPROUTERS
#discovery.zen.ping.multicast.enabled: false
#discovery.zen.minimum_master_nodes: 2
EOF

exec elasticsearch/bin/elasticsearch -f
